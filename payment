<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãŠæ”¯æ‰•ã„ - Beyond Time DNAæ¤œæŸ»</title>
<script src="https://js.stripe.com/v3/"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:#000;color:#fff;padding:20px;min-height:100vh;display:flex;align-items:center;justify-content:center}
.box{max-width:500px;width:100%;background:#111;padding:40px;border-radius:20px;border:2px solid #7a5cff;box-shadow:0 10px 40px rgba(122,92,255,.3)}
h1{color:#00d4ff;margin-bottom:30px;text-align:center;font-size:2rem;text-shadow:0 0 20px rgba(0,212,255,.5)}
.info{background:#222;padding:20px;border-radius:10px;margin-bottom:30px;border:1px solid #333}
.pname{color:#00d4ff;font-size:1.2rem;margin-bottom:10px;font-weight:700}
.pprice{color:#7a5cff;font-size:1.5rem;font-weight:900}
.group{margin-bottom:20px}
label{display:block;color:#00d4ff;margin-bottom:8px;font-size:0.9rem;font-weight:700}
input{width:100%;padding:12px;background:#222;border:2px solid #555;border-radius:8px;color:#fff;font-size:1rem;transition:border-color .3s}
input:focus{outline:none;border-color:#7a5cff;box-shadow:0 0 10px rgba(122,92,255,.3)}
#card-element{padding:12px;background:#222;border:2px solid #555;border-radius:8px;transition:border-color .3s}
#card-element.StripeElement--focus{border-color:#7a5cff}
button{width:100%;padding:15px;background:linear-gradient(135deg,#00d4ff,#7a5cff);border:none;border-radius:10px;color:#000;font-size:1.1rem;font-weight:900;cursor:pointer;margin-top:20px;transition:all .3s}
button:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 5px 20px rgba(122,92,255,.5)}
button:disabled{opacity:0.5;cursor:not-allowed}
.success{background:#004400;border:2px solid #00ff00;padding:30px;border-radius:10px;text-align:center;display:none;box-shadow:0 0 30px rgba(0,255,0,.3)}
.success.show{display:block}
.success h2{color:#00ff00;margin-bottom:20px;font-size:1.8rem;text-shadow:0 0 10px rgba(0,255,0,.5)}
.success p{line-height:1.8;font-size:1.1rem}
a{display:block;text-align:center;color:#888;margin-top:20px;text-decoration:none;font-size:0.9rem;transition:color .3s}
a:hover{color:#00d4ff}
.loading{text-align:center;color:#7a5cff;margin-top:10px;display:none}
.loading.show{display:block}
@media(max-width:500px){.box{padding:30px 20px}}
</style>
</head>
<body>

<div class="box">
<h1>ğŸ§¬ ãŠæ”¯æ‰•ã„</h1>

<div class="info" id="info">
<div class="pname" id="pname">èª­ã¿è¾¼ã¿ä¸­...</div>
<div class="pprice" id="pprice">Â¥---</div>
</div>

<div class="success" id="success">
<h2>âœ… æ±ºæ¸ˆæˆåŠŸï¼</h2>
<p id="stext"></p>
</div>

<form id="form">
<div class="group">
<label>ãŠåå‰ *</label>
<input type="text" id="name" placeholder="å±±ç”° å¤ªéƒ" required>
</div>

<div class="group">
<label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
<input type="email" id="email" placeholder="example@email.com" required>
</div>

<div class="group">
<label>ã‚«ãƒ¼ãƒ‰æƒ…å ± *</label>
<div id="card-element"></div>
</div>

<div class="loading" id="loading">Stripe ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

<button type="submit" id="btn">ğŸ§¬ è³¼å…¥ã™ã‚‹</button>
</form>

<a href="index.html">â† ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹ã«æˆ»ã‚‹</a>
</div>

<script>
(function(){
  'use strict';
  
  // Plan info
  const plans={
    100:{name:'åŸºæœ¬DNAæ¤œæŸ»',price:'Â¥100'},
    980:{name:'åº§æ¨™DNAæ¤œæŸ»',price:'Â¥980'},
    2980:{name:'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ DNAæ¤œæŸ»',price:'Â¥2,980'},
    29800:{name:'å®Œå…¨DNAæ¤œæŸ»',price:'Â¥29,800'}
  };
  
  const params=new URLSearchParams(window.location.search);
  const plan=parseInt(params.get('plan'))||980;
  const p=plans[plan];
  
  if(p){
    document.getElementById('pname').textContent=p.name;
    document.getElementById('pprice').textContent=p.price;
  }
  
  // Wait for Stripe to load
  let stripeLoadAttempts=0;
  const maxAttempts=50;
  
  function initStripe(){
    if(typeof Stripe==='undefined'){
      stripeLoadAttempts++;
      if(stripeLoadAttempts<maxAttempts){
        document.getElementById('loading').classList.add('show');
        setTimeout(initStripe,100);
      }else{
        alert('Stripe ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
      }
      return;
    }
    
    document.getElementById('loading').classList.remove('show');
    
    const KEY='pk_test_51SRULXE90hNxeF7bObkIHe2xyOrQ6NZEFhKwxj9UWFyAyCX65gpKDiXD1iMM3VgPDAWqfOuAJgphapS2Ss9vjwDu00iSwc7QTr';
    
    try{
      const stripe=Stripe(KEY);
      const elements=stripe.elements();
      const cardElement=elements.create('card',{
        style:{
          base:{
            color:'#fff',
            fontSize:'16px',
            fontFamily:'sans-serif',
            '::placeholder':{
              color:'#888'
            }
          },
          invalid:{
            color:'#ff6b6b'
          }
        }
      });
      
      cardElement.mount('#card-element');
      
      document.getElementById('form').addEventListener('submit',async function(e){
        e.preventDefault();
        
        const btn=document.getElementById('btn');
        const originalText=btn.textContent;
        btn.disabled=true;
        btn.textContent='å‡¦ç†ä¸­...';
        
        const name=document.getElementById('name').value.trim();
        const email=document.getElementById('email').value.trim();
        
        try{
          const result=await stripe.createPaymentMethod({
            type:'card',
            card:cardElement,
            billing_details:{
              name:name,
              email:email
            }
          });
          
          if(result.error){
            throw new Error(result.error.message);
          }
          
          // Success
          document.getElementById('form').style.display='none';
          document.getElementById('info').style.display='none';
          document.getElementById('success').classList.add('show');
          document.getElementById('stext').innerHTML='<strong>'+name+'</strong> æ§˜<br><br>ã”è³¼å…¥ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼<br><br>3ç§’å¾Œã«DNAæ¤œæŸ»ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™...';
          
          setTimeout(function(){
            window.location.href='index.html?paid=true&plan='+plan;
          },3000);
          
        }catch(error){
          alert('ã‚¨ãƒ©ãƒ¼: '+error.message);
          btn.disabled=false;
          btn.textContent=originalText;
        }
      });
      
    }catch(error){
      alert('Stripe ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: '+error.message);
    }
  }
  
  // Start initialization
  if(document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded',initStripe);
  }else{
    initStripe();
  }
})();
</script>

</body>
</html>
